<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>推薦結果</title>
    <link rel="stylesheet" href="../static/css/main.css" />
    <noscript
      ><link rel="stylesheet" href="assets/css/noscript.css"
    /></noscript>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>

  <body class="no-sidebar is-preload">
    <div id="page-wrapper">
      <!-- Nav -->
      <nav id="nav">
        <ul>
          <li><a href="index.html">首頁</a></li>
          <li><a href="./planner.html">智慧旅行排程</a></li>
          <li><a href="./fate_dice.html">命運骰子</a></li>
          <li><a href="./emotion.html">情緒導向推薦</a></li>
        </ul>
      </nav>

      <div class="wrapper style1">
        <article id="main" class="special">
          <header class="major">
            <h2>推薦行程</h2>
            <p>
              <i class="fa-solid fa-location-dot"></i
              >&nbsp;選擇一個您喜歡的行程吧！
            </p>
          </header>
        </article>
        <div class="re-box">
          <div class="re-container" id="recommendationContainer">
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div id="footer">
        <div class="container">
          <!-- Contact -->
          <section class="contact">
            <header>
              <h3>聯絡我們</h3>
            </header>
            <p>若有任何問題，非常歡迎您透過以下管道聯繫我們</p>
            <ul class="icons">
              <li>
                <a href="#" class="icon brands fa-facebook-f"
                  ><span class="label">Facebook</span></a
                >
              </li>
              <li>
                <a href="#" class="icon brands fa-instagram"
                  ><span class="label">Instagram</span></a
                >
              </li>
            </ul>
          </section>

          <!-- Copyright -->
          <div class="copyright">
            <ul class="menu">
              <li>&copy; Untitled. All rights reserved.</li>
              <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/js/jquery.dropotron.min.js"></script>
    <script src="../static/js/jquery.scrolly.min.js"></script>
    <script src="../static/js/jquery.scrollex.min.js"></script>
    <script src="../static/js/browser.min.js"></script>
    <script src="../static/js/breakpoints.min.js"></script>
    <script src="../static/js/util.js"></script>
    <script src="../static/js/main.js"></script>
    <script>
  document.addEventListener("DOMContentLoaded", function () {
    // 獲取將填充內容的父容器，這次我們要填充到 re-container 裡面
    const recommendationContainer = document.getElementById("recommendationContainer");
    // 確認你的 HTML 中 <div class="re-container"> 有 id="recommendationContainer"

    // 你可能也想更新主標題
    const mainTitleElement = document.querySelector('article#main header.major h2');

    const fateDiceResult = sessionStorage.getItem("fateDiceResult");

    if (fateDiceResult) {
      const data = JSON.parse(fateDiceResult);
      console.log("從 sessionStorage 讀取到的數據:", data);

      if (data.success) {

        let htmlContent = ""; // 用來儲存所有推薦景點的 HTML

        if (data.data && data.data.length > 0) {
          data.data.forEach((destination) => {
            // 每個行程都生成一個 div，並且帶有 re-result class
            htmlContent += `
                            <div class="re-result">
                                <h2>${destination.name}</h2>
                                ${destination.image_url ? `<img src="${destination.image_url}" alt="${destination.name}" style="max-width:100%; height:auto; margin-bottom: 1em;">` : ''}
                                <p><strong>地點描述：</strong>${destination.description}</p>
                                <p><strong>地址：</strong>${destination.address}</p>
                                <p><strong>類別：</strong>${destination.category}</p>
                                <p><strong>主題：</strong>${destination.theme}</p>
                                </div>
                        `;
          });
        } else {
          // 如果沒有找到景點
          htmlContent = `<p style="text-align: center; width: 100%;">很抱歉，沒有找到符合條件的推薦景點。</p>`;
        }

        // 將生成的 HTML 內容設置到 re-container 中
        if (recommendationContainer) {
          recommendationContainer.innerHTML = htmlContent;
        } else {
          console.error("無法找到 ID 為 'recommendationContainer' 的元素。");
        }
      } else {
        // API 返回 success: false 的情況
        if (mainTitleElement) {
          mainTitleElement.innerHTML = `推薦失敗`;
        }
        if (recommendationContainer) {
          recommendationContainer.innerHTML = `<p style="text-align: center; width: 100%;">推薦失敗: ${data.message}</p>`;
        } else {
          console.error("無法找到 ID 為 'recommendationContainer' 的元素。");
        }
      }
    } else {
      // session storage 中沒有數據的情況
      if (mainTitleElement) {
        mainTitleElement.innerHTML = `沒有推薦結果`;
      }
      if (recommendationContainer) {
        recommendationContainer.innerHTML = "<p style='text-align: center; width: 100%;'>沒有找到命運骰子推薦結果，請重新擲骰子。</p>";
      } else {
        console.error("無法找到 ID 為 'recommendationContainer' 的元素。");
      }
      // 如果沒有結果，導回骰子頁面
      setTimeout(() => {
        window.location.href = "./fate_dice.html";
      }, 2000); // 2秒後自動跳轉
    }
  });
</script>
  </body>
</html>